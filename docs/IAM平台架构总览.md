# IAM平台架构总览

## 项目概述

基于Spring Cloud Alibaba的企业级统一身份与权限管理平台（IAM Platform），采用微服务架构，为企业提供统一身份认证、集中权限管理、组织架构管理、合规审计等核心能力。

## 技术架构

### 核心技术栈
- **Spring Boot 3.2.9** + **Spring Security 6.1.5**
- **Spring Cloud Alibaba 2023.0.3.3**
- **Nacos 2.4.2**（注册中心 + 配置中心）
- **Spring Cloud Gateway 4.1.0**（API网关）
- **Sentinel 1.8.8**（限流熔断）
- **Seata 2.1.0**（分布式事务）
- **RocketMQ 5.3.1**（消息队列）
- **MySQL 8.0** + **Redis 6.0** + **Elasticsearch 7.17.9**

### 整体架构图

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                IAM平台架构图                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用层     │    │   移动端应用     │    │   第三方应用     │
│   Vue 3.0      │    │   H5/小程序      │    │   业务系统       │
│   Element Plus  │    │   React Native  │    │   OAuth2.1      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   API网关层      │
                    │ Spring Gateway  │
                    │   + Sentinel    │
                    │   + 限流熔断     │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │   服务治理层     │
                    │   Nacos         │
                    │ (注册+配置中心)  │
                    │   + Sentinel    │
                    │   + Seata       │
                    └─────────────────┘
                                 │
    ┌────────────────────────────┼────────────────────────────┐
    │                            │                            │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   认证服务       │    │   核心业务服务   │    │   审计服务       │
│ iam-auth-service│    │ iam-core-service│    │ iam-audit-service│
│   OAuth2.1      │    │   用户管理       │    │   操作日志       │
│   JWT Token     │    │   权限管理       │    │   登录日志       │
│   单点登录       │    │   组织管理       │    │   审计报表       │
│   多因子认证     │    │   数据权限       │    │   合规检查       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   系统服务       │
                    │ iam-system-     │
                    │   service       │
                    │   系统配置       │
                    │   消息通知       │
                    │   系统监控       │
                    └─────────────────┘
                                 │
                    ┌─────────────────┐
                    │   前端服务       │
                    │ iam-frontend    │
                    │   管理后台       │
                    │   Vue 3.0       │
                    │   Element Plus  │
                    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   数据存储层     │
                    │MySQL|Redis|ES   │
                    │MongoDB|RocketMQ │
                    │   数据隔离       │
                    └─────────────────┘
```

## 项目结构

### 分层架构设计

```text
iam-platform/
├── iam-common/                    # 公共模块（基础工具类、异常处理等）
├── iam-dependencies/              # 统一依赖版本管理
├── iam-starters/                  # Starters模块集合
│   ├── iam-commons/                       # 公共组件库
│   ├── iam-spring-boot-starter/           # 基础Spring Boot Starter
│   ├── iam-spring-boot-starter-web/       # Web相关Starter
│   ├── iam-spring-boot-starter-security/  # 安全相关Starter
│   ├── iam-spring-boot-starter-data/      # 数据访问Starter
│   ├── iam-spring-boot-starter-cache/     # 缓存相关Starter
│   ├── iam-spring-boot-starter-mq/        # 消息队列Starter
│   ├── iam-spring-boot-starter-audit/     # 审计相关Starter
│   ├── iam-spring-boot-starter-notification/ # 通知相关Starter
│   └── iam-spring-boot-starter-gateway/   # 网关相关Starter
├── iam-gateway/                   # 基础设施服务 - API网关 (8080)
├── services/                      # 微服务模块
│   ├── iam-auth-service/                  # 认证服务 (8081)
│   ├── iam-core-service/                  # 核心业务服务 (8082)
│   ├── iam-audit-service/                 # 审计服务 (8083)
│   └── iam-system-service/                # 系统服务 (8084)
├── apps/                          # 应用层服务
│   └── iam-frontend/                      # 前端服务 (8088)
├── config-init/                   # 配置初始化
├── docker-compose/                # Docker编排
├── docs/                          # 文档
└── scripts/                       # 脚本
```

### 分层职责说明

| 层级 | 目录 | 职责 | 特点 |
|------|------|------|------|
| **基础层** | `iam-common/` | 基础工具类、异常处理、常量定义 | 不依赖Spring框架，纯Java工具类 |
| **依赖管理** | `iam-dependencies/` | 统一依赖版本管理 | 集中管理所有第三方依赖版本 |
| **组件层** | `iam-starters/` | 提供各种功能的starter | 每个starter专注特定功能，开箱即用 |
| **基础设施层** | `iam-gateway/` | API网关服务 | 统一入口、路由转发、安全控制 |
| **微服务层** | `services/` | 业务微服务集合 | 按业务领域划分的独立服务 |
| **应用层** | `apps/` | 面向用户的应用服务 | 提供用户界面和特定应用场景 |

## 微服务架构

### 服务拆分策略

| 服务名称 | 端口 | 职责 | 数据库 | 分层 |
|---------|------|------|--------|------|
| iam-gateway | 8080 | API网关，统一入口，路由转发 | - | 基础设施层 |
| iam-auth-service | 8081 | 认证服务，OAuth2.1认证 | iam_auth | 微服务层 |
| iam-core-service | 8082 | 核心业务服务，用户/权限/组织管理 | iam_core | 微服务层 |
| iam-audit-service | 8083 | 审计服务，操作日志 | iam_audit | 微服务层 |
| iam-system-service | 8084 | 系统服务，配置/通知/监控 | iam_system | 微服务层 |
| iam-frontend | 8088 | 前端服务，管理后台 | - | 应用层 |

### 数据存储架构

```text
┌─────────────────────────────────────────────────────────────────┐
│                        数据存储架构                              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   MySQL集群      │    │   Redis集群      │    │   MongoDB       │
│   主从复制       │    │   数据分片       │    │   文档存储       │
│   读写分离       │    │   缓存策略       │    │   日志存储       │
│   数据隔离       │    │   会话存储       │    │   配置存储       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Elasticsearch │    │   RocketMQ      │    │   文件存储       │
│   日志检索       │    │   消息队列       │    │   对象存储       │
│   全文搜索       │    │   事件驱动       │    │   图片存储       │
│   数据分析       │    │   异步处理       │    │   文档存储       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Starters架构设计

### 为什么需要Starters模块？

参考Spring Cloud Alibaba的官方项目，`iam-starters`模块起到至关重要的作用：

1. **统一依赖管理**：将相关依赖组合在一起，形成功能完整的starter
2. **版本统一**：确保所有相关依赖的版本兼容性
3. **简化配置**：用户只需要引入一个starter就能获得完整功能
4. **自动配置**：根据classpath中的依赖自动配置相关组件
5. **最佳实践**：遵循Spring Boot的"约定优于配置"理念

### Starters模块详细说明

#### 1. iam-spring-boot-starter
**基础Spring Boot Starter**
- 统一响应结果处理
- 全局异常处理
- 基础配置
- 常用工具类

#### 2. iam-spring-boot-starter-web
**Web相关Starter**
- Spring Boot Web
- OpenFeign客户端
- CORS配置
- API文档（Knife4j）

#### 3. iam-spring-boot-starter-security
**安全相关Starter**
- Spring Security
- OAuth2.1认证
- JWT Token处理
- 密码编码器

#### 4. iam-spring-boot-starter-data
**数据访问Starter**
- MyBatis Plus
- MySQL连接
- Druid连接池
- Redis数据访问
- MongoDB支持
- Elasticsearch支持

#### 5. iam-spring-boot-starter-cache
**缓存相关Starter**
- Spring Cache抽象
- Redis缓存
- Caffeine本地缓存
- Redisson分布式锁

#### 6. iam-spring-boot-starter-mq
**消息队列Starter**
- RocketMQ集成
- Spring Cloud Stream
- 消息发送和消费
- 事务消息

#### 7. iam-spring-boot-starter-audit
**审计相关Starter**
- 操作日志记录
- 登录日志记录
- 审计配置
- AOP切面

#### 8. iam-spring-boot-starter-notification
**通知相关Starter**
- 邮件通知
- 短信通知
- 微信通知
- 消息模板

#### 9. iam-spring-boot-starter-gateway
**网关相关Starter**
- Spring Cloud Gateway
- 路由配置
- 限流熔断
- 负载均衡

### 使用示例

以`iam-user-service`为例：

```xml
<dependencies>
    <!-- 基础功能 -->
    <dependency>
        <groupId>com.xiaoxin</groupId>
        <artifactId>iam-spring-boot-starter</artifactId>
    </dependency>
    
    <!-- Web功能 -->
    <dependency>
        <groupId>com.xiaoxin</groupId>
        <artifactId>iam-spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- 数据访问 -->
    <dependency>
        <groupId>com.xiaoxin</groupId>
        <artifactId>iam-spring-boot-starter-data</artifactId>
    </dependency>
    
    <!-- 缓存 -->
    <dependency>
        <groupId>com.xiaoxin</groupId>
        <artifactId>iam-spring-boot-starter-cache</artifactId>
    </dependency>
    
    <!-- 审计 -->
    <dependency>
        <groupId>com.xiaoxin</groupId>
        <artifactId>iam-spring-boot-starter-audit</artifactId>
    </dependency>
</dependencies>
```

## 技术架构

### Spring Cloud Alibaba技术栈

```text
┌─────────────────────────────────────────────────────────────────┐
│                    Spring Cloud Alibaba技术栈                   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Spring Boot   │    │   Spring Cloud  │    │ Spring Cloud    │
│      3.2.9      │    │     2023.0.3    │    │   Alibaba       │
│   基础框架       │    │   微服务框架     │    │   2023.0.3.3    │
│   自动配置       │    │   服务治理       │    │   阿里组件       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Nacos         │    │   Sentinel      │    │   Seata         │
│   注册中心       │    │   限流熔断       │    │   分布式事务     │
│   配置中心       │    │   系统保护       │    │   数据一致性     │
│   服务发现       │    │   流量控制       │    │   事务管理       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   RocketMQ      │    │   Spring        │    │   MyBatis Plus  │
│   消息队列       │    │   Gateway       │    │   数据访问       │
│   事件驱动       │    │   API网关       │    │   ORM框架        │
│   异步处理       │    │   路由转发       │    │   代码生成       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 安全架构

```text
┌─────────────────────────────────────────────────────────────────┐
│                          安全架构                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   认证层         │    │   授权层         │    │   审计层         │
│   OAuth2.1      │    │   RBAC模型       │    │   操作日志       │
│   JWT Token     │    │   权限验证       │    │   登录日志       │
│   单点登录       │    │   数据权限       │    │   审计报表       │
│   多因子认证     │    │   字段权限       │    │   合规检查       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   传输安全       │    │   存储安全       │    │   访问安全       │
│   HTTPS/TLS     │    │   数据加密       │    │   IP白名单       │
│   证书管理       │    │   密码加密       │    │   频率限制       │
│   防重放攻击     │    │   敏感数据脱敏   │    │   会话管理       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 核心特性

### 1. 统一身份认证
- OAuth2.1 + OpenID Connect标准实现
- JWT Token认证机制
- 单点登录（SSO）支持
- 多因子认证（MFA）
- 第三方登录集成

### 2. 权限管理
- RBAC（基于角色）权限模型
- 细粒度权限控制
- 数据权限隔离
- 字段权限控制
- 动态权限验证

### 3. 组织架构管理
- 多级部门管理
- 岗位体系管理
- 组织架构可视化
- 部门权限隔离

### 4. 审计合规
- 完整的操作日志记录
- 登录日志追踪
- 审计报表生成
- 合规性检查

### 5. 系统管理
- 菜单管理
- 字典管理
- 参数配置
- 系统监控

## 部署架构

### 容器化部署

```text
┌─────────────────────────────────────────────────────────────────┐
│                        容器化部署架构                           │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Docker        │    │   Kubernetes    │    │   Helm Chart    │
│   容器化         │    │   容器编排       │    │   包管理         │
│   镜像构建       │    │   服务发现       │    │   版本管理       │
│   容器运行       │    │   负载均衡       │    │   配置管理       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   CI/CD         │    │   监控告警       │    │   日志管理       │
│   持续集成       │    │   Prometheus    │    │   ELK Stack     │
│   持续部署       │    │   Grafana       │    │   日志收集       │
│   自动化测试     │    │   告警通知       │    │   日志分析       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 高可用架构

```text
┌─────────────────────────────────────────────────────────────────┐
│                        高可用架构                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   负载均衡       │    │   服务集群       │    │   数据集群       │
│   Nginx/HAProxy │    │   多实例部署     │    │   MySQL主从     │
│   健康检查       │    │   自动伸缩       │    │   Redis集群     │
│   故障转移       │    │   故障恢复       │    │   数据备份       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   容灾备份       │    │   监控告警       │    │   安全防护       │
│   异地容灾       │    │   实时监控       │    │   防火墙         │
│   数据备份       │    │   异常告警       │    │   WAF防护       │
│   灾难恢复       │    │   性能监控       │    │   DDoS防护      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 开发规范

### 代码规范
- 遵循阿里巴巴Java开发手册
- 使用Lombok简化代码
- 统一异常处理
- 统一响应格式

### 接口规范
- RESTful API设计
- 统一响应格式：`{code, message, data, timestamp}`
- 接口版本管理：`/api/v1/`
- OpenAPI 3.0文档

### 安全规范
- JWT Token认证
- 接口权限验证
- 数据脱敏
- 操作审计

## 性能指标

### 性能要求
- 登录响应时间 < 500ms
- 页面加载时间 < 2s
- 接口响应时间 < 200ms（95%请求）
- 支持10,000+并发用户
- 系统可用性 > 99.9%

### 扩展性
- 支持水平扩展
- 支持动态扩容
- 支持多租户
- 支持国际化

## 访问地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 管理后台 | http://localhost:8080 | 主要访问入口 |
| API文档 | http://localhost:8080/doc.html | Swagger文档 |
| Nacos控制台 | http://localhost:8848/nacos | 服务注册发现 |
| Sentinel控制台 | http://localhost:8080 | 限流熔断监控 |
| RocketMQ控制台 | http://localhost:8180 | 消息队列监控 |

## 默认账号
- **管理员账号**: admin
- **默认密码**: 123456

## 部署方案

### 开发环境
```bash
# 启动基础服务
docker-compose up -d mysql redis nacos

# 执行数据库脚本
mysql -h localhost -u root -p < config-init/sql/init.sql

# 启动应用服务
./config-init/scripts/start.sh
```

### 生产环境
- Docker容器化部署
- Kubernetes集群部署
- 负载均衡配置
- 监控告警体系

## 项目优势

### 1. 技术先进性
- 采用最新的Spring Cloud Alibaba 2023.x版本
- 支持JDK 17+，享受最新语言特性
- 完整的微服务治理体系

### 2. 架构完整性
- 从认证授权到审计合规的完整解决方案
- 企业级的安全设计
- 高可用的架构设计

### 3. 扩展性强
- 微服务架构，支持独立部署和扩展
- 插件化设计，支持功能扩展
- 多租户支持，支持SaaS模式

### 4. 运维友好
- 完整的监控体系
- 容器化部署
- 自动化运维

## 下一步计划

### 1. 功能完善
- [ ] 完善各微服务的具体业务逻辑
- [ ] 实现前端管理界面
- [ ] 添加单元测试和集成测试
- [ ] 完善API文档

### 2. 性能优化
- [ ] 缓存策略优化
- [ ] 数据库性能调优
- [ ] 接口性能优化
- [ ] 前端性能优化

### 3. 安全加固
- [ ] 安全漏洞扫描
- [ ] 渗透测试
- [ ] 安全策略优化
- [ ] 合规性检查

### 4. 运维完善
- [ ] 监控告警体系
- [ ] 日志分析系统
- [ ] 自动化部署
- [ ] 灾难恢复方案

## 总结

IAM平台项目采用Spring Cloud Alibaba微服务架构，技术栈先进，架构设计合理，具备良好的扩展性和可维护性。通过分层架构设计，将基础设施、微服务、应用层清晰分离，通过Starters模块实现统一依赖管理和开箱即用的功能组件。

项目为后续的功能开发奠定了坚实的基础，可以在此基础上继续完善具体的业务逻辑，实现完整的企业级IAM解决方案。
